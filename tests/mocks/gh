#!/usr/bin/env bash
# Mock gh CLI for testing

# Mock data files should be set via environment:
# MOCK_RUN_LIST_JSON - response for gh run list
# MOCK_RUN_VIEW_JSON - response for gh run view (can be a function of run_id)
# MOCK_REPO_JSON - response for gh repo view
# MOCK_PR_JSON - response for gh pr view

case "$1" in
    repo)
        if [[ "$2" == "view" ]]; then
            if [[ -n "${MOCK_REPO_JSON:-}" ]]; then
                echo "$MOCK_REPO_JSON"
            else
                echo '{"nameWithOwner": "test-owner/test-repo"}'
            fi
        fi
        ;;
    pr)
        if [[ "$2" == "view" ]]; then
            if [[ -n "${MOCK_PR_JSON:-}" ]]; then
                echo "$MOCK_PR_JSON"
            else
                echo '{"number": 42, "url": "https://github.com/test-owner/test-repo/pull/42"}'
            fi
        fi
        ;;
    run)
        if [[ "$2" == "list" ]]; then
            if [[ -n "${MOCK_RUN_LIST_JSON:-}" ]]; then
                echo "$MOCK_RUN_LIST_JSON"
            else
                echo '[{"databaseId": 12345, "status": "completed", "conclusion": "success", "name": "CI"}]'
            fi
        elif [[ "$2" == "view" ]]; then
            run_id="$3"
            # Check for run-specific mock
            var_name="MOCK_RUN_VIEW_${run_id}"
            if [[ -n "${!var_name:-}" ]]; then
                echo "${!var_name}"
            elif [[ -n "${MOCK_RUN_VIEW_JSON:-}" ]]; then
                echo "$MOCK_RUN_VIEW_JSON"
            else
                echo '{"status": "completed", "conclusion": "success", "name": "CI", "url": "https://github.com/test-owner/test-repo/actions/runs/12345", "jobs": [{"name": "build", "status": "completed", "conclusion": "success", "databaseId": 111}]}'
            fi
        fi
        ;;
    *)
        echo "Mock gh: unknown command $*" >&2
        exit 1
        ;;
esac
